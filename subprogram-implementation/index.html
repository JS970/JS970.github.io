<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
<title>Subprogram Implementation | Rounding Off</title>



<meta property="og:title" content="Subprogram Implementation">



<meta name="author" content="JS970">


<meta property="og:locale" content="en-US">


<meta name="description" content="writing is much easier than remembering">
<meta property="og:description" content="writing is much easier than remembering">



<link rel="canonical" href="https://js970.github.io/subprogram-implementation/">
<meta property="og:url" content="https://js970.github.io/subprogram-implementation/">



<meta property="og:site_name" content="Rounding Off" />





  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2023-06-12T00:00:00+00:00">







  <meta name="twitter:card" content="summary">



  <meta property="twitter:title" content="Subprogram Implementation">








<script type="application/ld+json">
{
  "author": {
    "@type":"Person",
	  "name":"JS970",
  },
  "description": "writing is much easier than remembering",
  "url": "https://js970.github.io/subprogram-implementation/",
  "@context":"https://schema.org",
  "@type": "BlogPosting",
  "headline": "Subprogram Implementation"
  
    
    
      "datePublished":"2023-06-12T00:00:00+00:00",
    
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://js970.github.io/subprogram-implementation/"
    },
  
}
</script>

  <link rel="stylesheet" href="https://js970.github.io/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

  <link rel="icon" type="image/png" sizes="32x32" href="https://js970.github.io/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://js970.github.io/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://js970.github.io/assets/apple-touch-icon.png">

  
    <link type="application/atom+xml" rel="alternate" href="https://js970.github.io/atom.xml" title="Rounding Off" />
  

  

  
  
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
	integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
	integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
	integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
	onload="renderMathInElement(document.body);"></script>

</head>

<body>
  
  <nav class="nav">
    <div class="nav-container">
      <a href="https://js970.github.io/">
        <h2 class="nav-title">Rounding Off</h2>
      </a>
      <ul>
        
          
            <li><a href="https://js970.github.io">Posts</a></li>
          
            <li><a href="https://js970.github.io/tags">Tags</a></li>
          
            <li><a href="https://js970.github.io/about">About</a></li>
          
        
      </ul>
    </div>
  </nav>
  

  <main>
    
  <div class="post">
  	<div class="post-info">
  		<span>Written by</span> JS970<br>
  		
  		<span>on&nbsp;</span><time datetime="2023-06-12">June 12, 2023</time>
  	</div>
  	<h1 class="post-title">Subprogram Implementation</h1>
  	<div class="post-line"></div>
  	<h2 id="subprogram-linkage">Subprogram Linkage</h2>
<hr />
<h3 id="ssebbepeuroggeraem-hyeoggyeo">서브프로그램 연결</h3>
<ul>
<li>서브프로그램 호출 - <code>call</code></li>
<li>서브프로그램 복귀 - <code>return</code></li>
</ul>
<h3 id="ssebbepeuroggeraem-hocul-si-haeya-hal-jjaheo">서브프로그램 호출 시 해야 할 작업</h3>
<ul>
<li>data 처리
<ul>
<li>호출하는 서브프로그램의 상태 저장</li>
<li>인수 전달 작업</li>
<li>복귀할 주소 전달</li>
</ul>
</li>
<li>control
<ul>
<li>호출되는 프로그램으로 분기</li>
</ul>
</li>
</ul>
<h3 id="ssebbepeuroggeraem-bboggw-si-haeya-hal-jjaheo">서브프로그램 복귀 시 해야 할 작업</h3>
<ul>
<li>data 처리
<ul>
<li>필요에 따라 형식인수 값 복사(outer parameter)</li>
<li>함수의 경우, 결과 값 전달</li>
<li>호출한 서브프로그램의 상태 복귀</li>
</ul>
</li>
<li>control
<ul>
<li>호출한 서브프로그램으로 분기</li>
</ul>
</li>
</ul>
<h2 id="activation-record">Activation Record</h2>
<hr />
<ul>
<li>서브프로그램을 호출할 때는 아래와 같은 공간이 필요하다.
<ul>
<li>호출자의 상태 정보를 보관할 공간</li>
<li>인수를 저장할 공간</li>
<li>함수의 반환 값을 저장할 공간</li>
<li>복귀할 주소를 저장할 공간</li>
</ul>
</li>
<li>활성 레코드(activation record)란 수행중인 서브프로그램에서 코드를 제외한 부분이 저장되는 형태이다.</li>
<li>활성 레코드 틀 자체는 정적으로 결정 가능하다.</li>
<li>활성 레코드 인스턴스란 활성 레코드가 구체적으로 구축된 것이다.
<ul>
<li>활성 레코드 인스턴스는 실행 시 필요에 따라 생성 및 소멸된다.</li>
<li>활성 레코드 인스턴스를 활성 레코드라고 부른다.</li>
</ul>
</li>
</ul>
<h3 id="hwalsseon-rekodde-jjeonjjeo-halddan">활성 레코드 - 정적 할당</h3>
<ul>
<li>아래 그림은 FORTRAN 77의 활성 래코드 구조이다.<img src="/image/PL/fortranRecord.png" alt="FORTRAN77 Activation Record" /></li>
<li>호출 여부와 관계없이 미리 서브프로그램을 만들어 static segment로 할당했으므로 재귀 호출을 허용하지 않는다.</li>
<li>활성 레코드를 정적으로 할당 가능하다.</li>
</ul>
<h3 id="hwalsseon-rekodde-ddonjjeo-halddan">활성 레코드 - 동적 할당</h3>
<ul>
<li>아래 예시 Ada 코드를 바탕으로 활성 레코드 형태에 대해 알아보자.<pre data-lang="Ada" style="background-color:#2b303b;color:#c0c5ce;" class="language-Ada "><code class="language-Ada" data-lang="Ada"><span>procedure Main_2 is
</span><span>	X: Integer;
</span><span>	procedure Bigsub is
</span><span>		A, B, C: Integer;
</span><span>		procedure Sub1 is
</span><span>			A, D: Integer;
</span><span>			begin --Sub1
</span><span>				A:=B+C;
</span><span>			end;
</span><span>		procedure Sub2(X: Integer) is
</span><span>			B, E: Integer;
</span><span>			procedure Sub3 is
</span><span>				C, E: Integer;
</span><span>				begin --Sub3
</span><span>					Sub1;
</span><span>					E:=B+A;
</span><span>				end;
</span><span>			begin --Sub2
</span><span>				Sub3;
</span><span>				A:=D+E;
</span><span>			end;
</span><span>		begin --Bigsub
</span><span>			Sub2 (7);
</span><span>		end;
</span><span>	begin --Main_2
</span><span>		Bigsub;
</span><span>	end;
</span></code></pre>
</li>
<li>아래 그림은 예시 Ada 프로그램의 활성 레코드 구조이다.<img src="/image/PL/adaRecord.png" alt="ALGOL Activation Record" /></li>
<li>재귀 호출이 가능하다.</li>
<li>static scoping rules를 지원한다.</li>
<li>활성 레코드의 형태는 같지만 크기는 각 서브프로그램마다 다르다.</li>
<li>서브프로그램 호출 시 동적으로 활성 레코드가 생성된다.</li>
<li>활성 레코드 필드는 프레임 포인터(FP)와 offset의 조합으로 참조한다.</li>
<li>활성 레코드에는 아래와 같은 내용들이 저장된다.
<ul>
<li>Local variables &amp; Parameters</li>
<li>Dynamic Link : 호출자 활성 레코드의 FP를 가리킨다.</li>
<li>Return address : 정적 부모(static parent)의 FP를 가리킨다.</li>
<li>return value(함수의 경우)</li>
</ul>
</li>
<li>점선은 static link를 통해 정적 부모를 가리키는 것을 의미한다.</li>
<li>실선은 dynamic link를 통해 호출자를 카리키는 것을 의미한다.</li>
</ul>
<h3 id="terminology">Terminology</h3>
<ul>
<li><code>동적 체인</code> : 활성 레코드 스택 상에서 인접한 동적 링크들을 차례로 연결한 것. <code>리스트</code> 형태이다.</li>
<li><code>정적 체인</code> : 활성 레코드 스택 상에서 정적 링크들로 연결된 체인. <code>트리</code> 형태이다.
<ul>
<li><code>C</code>언어의 경우 함수 중첩을 허용하지 않으므로 정적 링크가 필요 없다.</li>
</ul>
</li>
<li><code>local offset</code> : 지역 변위
<ul>
<li>활성 레코드 시작 부분에서 stack dynamic 변수 위치까지의 변위</li>
<li>컴파일 시간에 계산 가능하다.</li>
</ul>
</li>
</ul>
<h2 id="bijihyeo-bbyeosu-camjo">비지역 변수 참조</h2>
<hr />
<ul>
<li>지역변수는 항상 자신의 활성 레코드 인스턴스에서 찾을 수 있다.</li>
<li>참조되는 비지역 변수는 활성레코드 스택 어딘가에 존재한다.</li>
<li>어떤 영역 규칙이든 활성레코드 스택을 찾아 보면 항상 비지역 변수를 찾을 수 있다.
<ul>
<li>parent는 항상 active하기 때문이다.</li>
</ul>
</li>
<li>비지역 변수의 참조를 위해서는 올바른 <code>offeet</code>과 올바른 <code>활성 레코드</code>를 찾는 것이 중요하다.
<ul>
<li><code>FP</code>와 <code>offset</code>을 이용해서 비지역 변수에 접근하기 때문</li>
</ul>
</li>
<li>정적 영역규칙에 따른 비지역 참조 구현의 문제점
<ul>
<li>정적 부모의 활성 레코드가 인접해 있지 않을 수 있다.</li>
<li>정적 링크를 반복하여 거슬러 찾아가야 한다.</li>
<li>어떤 서브프로그램의 정적 체인은 모든 정적 조상을 포함한다.</li>
</ul>
</li>
</ul>
<h3 id="jjeonjjeo-ceinheu-sahyonhahye-bijihyeo-bbyeosureul-camjohaneun-bbeo">정적 체인을 사용하여 비지역 변수를 참조하는 법</h3>
<ul>
<li>정적 깊이(static depth)를 이용한다. 이는 자신을 감싸고 있는 정적 영역의 개수를 의미한다.</li>
<li>비지역 참조의 체인 변위(chain offset)을 활용한다.
<ul>
<li>비지역 변수가 참조되는 지점의 정적 깊이와 해당 비지역 변수가 선언된 지점의 정적 깊이의 차를 의미</li>
<li>체인 변위만큼 정적 체인을 거슬러 올라가면 해당 변수의 활성 레코드 인스턴스를 찾을 수 있다.</li>
</ul>
</li>
<li>체인을 거슬러 올라가는 비용은 체인 변위가 클수록 크다.</li>
<li>정적 체인 방법의 장점
<ul>
<li>구현하기 쉽다</li>
<li>각 활성 레코드에 하나의 링크만 유지하면 되므로 공간 낭비가 적다.</li>
</ul>
</li>
<li>정적 체인 방법의 단점
<ul>
<li>참조되는 비지역 변수가 선언된 블록의 중첩깊이와 참조 문장을 포함한 중첩깊이의 차이가 크다면 참조 시간 부담이 커진다.</li>
<li>비지역 변수의 참조 시간이 변수에 따라 다르기 때문에 응답 시간이 중요한 real-time application에서는 불리하다.</li>
</ul>
</li>
</ul>
<h3 id="dissepeulrei-bbanbbeo">디스플레이 방법</h3>
<ul>
<li>여러 정적 링크들을 별도의 스택에 관리한다.</li>
<li>참조 환경의 모든 변수는 이 스택이 가리키는 활성 레코드 내에 존재한다.</li>
<li>디스플레이는 현재 수행 중인 블록과 이 블록의 정적 조상에 대한 활성 레코드를 가리키는 주소들로 이루어진 스택이다.</li>
<li>디스플레이 변위는 해당 변수가 선언된 서브 프로그램의 정적 깊이와 동일하다. 즉 static depth가 3인 경우 display[3]에 저장된다. </li>
<li>디스플레이에 의한 서브프로그램 호출 및 복귀 과정은 다음과 같다.
<ol>
<li>호출되는 서브프로그램의 정적 깊이가 k라면 display[k]에 서브프로그램의 활성 레코드 인스턴스 주소를 저장한다.</li>
<li>만약 display[k] 위치에 이미 다른 서브프로그램을 저장 중인 경우 원래 있던 항목을 호출되는 서브프로그램의 활성 레코드 내에 backup한다.</li>
<li>서브프로그램 복귀 시에는 현재 활성레코드 내에 백업되었던 display[k]를 복구한다.</li>
</ol>
</li>
<li>display가 어떻게 변화할 지 알 수 없으므로 모든 경우에 대해 백업을 진행해야 한다.
<ul>
<li>애초에 활성 레코드가 저장되어 있지 않은 상태 재외</li>
</ul>
</li>
</ul>
<h3 id="jjeonjjeo-cein-bbanbbeogwa-dissepeulrei-bbanbbeoyi-biggy">정적 체인 방법과 디스플레이 방법의 비교</h3>
<ul>
<li>지역변수 참조는 동일하다.</li>
<li>비지역 변수 참조에 있어 현재 활성 레코드와 한 단계 차이날 경우 두 방법의 비용이 동일하지만 그 이상의 경우 디스플레이 방법이 더 유리하다.</li>
<li>서브프로그램 호출에 있어 디스플레이 방법의 경우 정적 깊이 차가 클수록 정적 체인 방법에 비해 유리하다.</li>
<li>서브프로그램 복귀에 있어 정적 체인 방법과 디스플레이 방법 모두 상수 시간을 보장한다. 하지만 디스플레이 방법의 경우 백업 시간을 추가로 요구하므로 시간이 조금 더 소요된다.</li>
<li>결론적으로 비지역 변수 참조가 빈번하다면 디스플레이 방법이 유리하고, 거의 일어나지 않는다면 정적 체인 방법이 더 유리하다.</li>
</ul>
<h3 id="ddonjjeo-hyeonhyeoggycig-deep-access">동적 영역규칙 - Deep Access</h3>
<ul>
<li>해당 변수를 찾을 때까지 동적 링크를 계속해서 거슬러 올라간다.</li>
<li>거슬러 올라갈 체인 길이가 정해져 있지 않으므로 시간을 보장할 수 없다.</li>
<li>활성 레코드에 변수 이름을 기록해야 한다.</li>
</ul>
<h3 id="ddonjjeo-hyeonhyeoggycig-shallow-access">동적 영역규칙 - Shallow Access</h3>
<ul>
<li>참조할 변수를 공용 공간에 저장한다.</li>
<li>Variable Stack, 또는 Central Table방식으로 구현한다.</li>
<li>아래는 Variable Stack방식으로 구현하는 도식이다.<img src="/image/PL/variableStack.png" alt="Variable Stack" />
<ul>
<li>디스플레이 방법과 유사한 면이 있다.</li>
<li>각 변수 별로 스텍을 가지며, stack.top()을 참조하여 비지역 변수에 접근한다.</li>
</ul>
</li>
</ul>

  </div>

	

  <div class="pagination">
  	
		<a href="#" class="top">Top</a>
		
  </div>

  </main>

  
  <footer>
    <span>&copy; 2022 JS970. Made with <a href="https://www.getzola.org">Zola</a> using the <a
          href="https://github.com/aaranxu/tale-zola">Tale-Zola</a> theme.</span>
  </footer>
  
</body>
</html>
