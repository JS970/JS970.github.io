<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
<title>Lua | Rounding Off</title>



<meta property="og:title" content="Lua">



<meta name="author" content="JS970">


<meta property="og:locale" content="en-US">


<meta name="description" content="writing is much easier than remembering">
<meta property="og:description" content="writing is much easier than remembering">



<link rel="canonical" href="https://js970.github.io/lua/">
<meta property="og:url" content="https://js970.github.io/lua/">



<meta property="og:site_name" content="Rounding Off" />





  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2023-05-15T00:00:00+00:00">







  <meta name="twitter:card" content="summary">



  <meta property="twitter:title" content="Lua">








<script type="application/ld+json">
{
  "author": {
    "@type":"Person",
	  "name":"JS970",
  },
  "description": "writing is much easier than remembering",
  "url": "https://js970.github.io/lua/",
  "@context":"https://schema.org",
  "@type": "BlogPosting",
  "headline": "Lua"
  
    
    
      "datePublished":"2023-05-15T00:00:00+00:00",
    
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://js970.github.io/lua/"
    },
  
}
</script>

  <link rel="stylesheet" href="https://js970.github.io/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

  <link rel="icon" type="image/png" sizes="32x32" href="https://js970.github.io/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://js970.github.io/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://js970.github.io/assets/apple-touch-icon.png">

  
    <link type="application/atom+xml" rel="alternate" href="https://js970.github.io/atom.xml" title="Rounding Off" />
  

  

  
  
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
	integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
	integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
	integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
	onload="renderMathInElement(document.body);"></script>

</head>

<body>
  
  <nav class="nav">
    <div class="nav-container">
      <a href="https://js970.github.io/">
        <h2 class="nav-title">Rounding Off</h2>
      </a>
      <ul>
        
          
            <li><a href="https://js970.github.io">Posts</a></li>
          
            <li><a href="https://js970.github.io/tags">Tags</a></li>
          
            <li><a href="https://js970.github.io/about">About</a></li>
          
        
      </ul>
    </div>
  </nav>
  

  <main>
    
  <div class="post">
  	<div class="post-info">
  		<span>Written by</span> JS970<br>
  		
  		<span>on&nbsp;</span><time datetime="2023-05-15">May 15, 2023</time>
  	</div>
  	<h1 class="post-title">Lua</h1>
  	<div class="post-line"></div>
  	<h2 id="lua-intro">Lua Intro</h2>
<hr />
<h3 id="about-lua">About Lua</h3>
<ul>
<li>단순하고 쉬운 구문을 가진다.</li>
<li>Python과 유사하지만 들여쓰기 언어는 아니다.(인덴트 무시해도 됨)</li>
<li>Hybrid implementation 방식으로 구현되어 속도 역시 Python과 비교했을 때 훨씬 빠르다.</li>
<li>동적 타입 언어이며, garbage collection을 통한 자동 메모리 관리 기능이 있다.</li>
<li>ANSI C로 작성되었으며 엔진이 공개되어 있다.</li>
</ul>
<h3 id="env-setting">Env Setting</h3>
<ul>
<li><a href="http://www.lua.org/download.html">Download Page</a></li>
<li>At Terminal(Mac tested)
<ul>
<li>별도의 환경 변수 설정을 할 필요는 없다.</li>
</ul>
</li>
</ul>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">curl -R -O</span><span> http://www.lua.org/ftp/lua-5.4.4.tar.gz
</span><span style="color:#bf616a;">tar -zxf</span><span> lua-5.4.4.tar.gz
</span><span style="color:#96b5b4;">cd</span><span> lua-5.4.4
</span><span style="color:#bf616a;">make</span><span> all test
</span></code></pre>
<ul>
<li>Visual Studio에서 작업하는 것을 권장한다. 아래 확장 프로그램을 설치해서 사용한다.
<ul>
<li>Code Runner(필수)</li>
<li>Lua, Lua Debug(Optional)</li>
</ul>
</li>
</ul>
<h3 id="lua-resources">Lua Resources</h3>
<ul>
<li>Lua Books
<ul>
<li><a href="https://www.amazon.com/Programming-Third-Edition-Roberto-Ierusalimschy/dp/859037985X">Programming in Lua</a></li>
<li><a href="http://www.lua.org/pil/contents.html">The first edition is available online</a></li>
<li><a href="https://www.amazon.com/gp/product/0470069171/">Beginning Lua Programming</a></li>
</ul>
</li>
<li>Lua Tutorial
<ul>
<li><a href="https://tylerneylon.com/a/learn-lua/">Learn Lua in 15 Minutes</a></li>
<li><a href="https://ebens.me/post/lua-for-programmers-part-1/">Lua for Programmers</a></li>
<li><a href="https://www.w3big.com/lua/default.html">w3big.com</a></li>
<li><a href="https://www.tutorialspoint.com/lua/index.htm">tutorialspoint.com</a></li>
</ul>
</li>
<li>Other Useful Sites
<ul>
<li><a href="http://lua-users.org/">lua-users.org</a></li>
<li><a href="http://lua-users.org/wiki/LuaShortReference">Lua Short Reference</a></li>
</ul>
</li>
</ul>
<h2 id="lua">Lua</h2>
<hr />
<h3 id="data-types">Data Types</h3>
<ul>
<li><code>nil</code> : null과 같은 표현이다. 초기 LISP에서 사용되었던 표현을 계승했다.</li>
<li><code>boolean</code> : False and True</li>
<li><code>number</code> : 정수, 부동소수점 모두 <code>number</code>타입이다.</li>
<li><code>string</code> : 문자열</li>
<li><code>table</code> : 연관 배열(Python의 dictionary와 유사하다)
<ul>
<li>테이블 원소에 필드 이름을 붙이면 레코드처럼 사용할 수 있다.</li>
<li>참조할 때는 필드 이름을 문자열로 참조한다. 아래 프로그램은 7을 출력한다.</li>
</ul>
<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#bf616a;">pnt </span><span>= {</span><span style="color:#a3be8c;">x</span><span>=</span><span style="color:#d08770;">3</span><span>, </span><span style="color:#a3be8c;">y</span><span>=</span><span style="color:#d08770;">4</span><span>}
</span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#bf616a;">pnt</span><span>[&quot;</span><span style="color:#a3be8c;">x</span><span>&quot;] + </span><span style="color:#bf616a;">pnt</span><span>[&quot;</span><span style="color:#a3be8c;">y</span><span>&quot;])
</span></code></pre>
<ul>
<li>Mixed  Table형태로 레코드와 배열을 한 테이블에 사용 가능하다.</li>
<li>이때 레코드와 배열의 구분을 위해 <code>;</code>를 사용한다.</li>
</ul>
<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#bf616a;">fav </span><span>= {</span><span style="color:#a3be8c;">name</span><span>=&quot;</span><span style="color:#a3be8c;">Lua</span><span>&quot;, </span><span style="color:#a3be8c;">year</span><span>={</span><span style="color:#d08770;">1993</span><span>}; &quot;</span><span style="color:#a3be8c;">script</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">dynamic</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">fast</span><span>&quot;}
</span></code></pre>
<ul>
<li>for구문에서 pair함수를 사용하여 테이블의 key를 참조할 수 있다.	
<ul>
<li>pair함수는 테이블의 key, value를 반환하는 반복자다.</li>
<li>아래 프로그램에서는 k만 사용했으므로 value부분이 버려진 상태이다.</li>
</ul>
</li>
</ul>
<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">for </span><span style="color:#bf616a;">k </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">pairs</span><span>(</span><span style="color:#bf616a;">fav</span><span>) </span><span style="color:#b48ead;">do
</span><span>	</span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#bf616a;">k</span><span>)
</span><span style="color:#b48ead;">end
</span></code></pre>
<ul>
<li>for 구문에서 ipairs함수를 활용하여 테이블의 배열을 표현할 수 있다.
<ul>
<li>ipairs함수는 테이블의 index, value를 반환하는 반복자다.</li>
</ul>
</li>
</ul>
<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">for </span><span style="color:#bf616a;">i</span><span>, </span><span style="color:#bf616a;">v </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">ipairs</span><span>(</span><span style="color:#bf616a;">fav</span><span>) </span><span style="color:#b48ead;">do
</span><span>	</span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#bf616a;">i</span><span>, </span><span style="color:#bf616a;">v</span><span>)
</span><span style="color:#b48ead;">end
</span></code></pre>
</li>
<li><code>type()</code>을 이용하여 변수의 타입을 확인 가능하다.</li>
</ul>
<h3 id="operators">Operators</h3>
<ul>
<li>본 절에서는 <code>Lua</code>의 특이한 operator에 대해서만 기술한다.</li>
<li>자세한 정보는 <a href="http://www.lua.org/download.html">Download Page</a>에서 다운받은 파일을 압축 해제하여 README.md를 읽어보자.</li>
<li>비교 연산자
<ul>
<li><code>~=</code> : 다른 언어에서의 <code>!=</code>표현과 같은 의미이다.</li>
</ul>
</li>
<li>산술 연산자
<ul>
<li><code>^</code> : 거듭제곱을 연산하는 산술 연산자이다.</li>
</ul>
</li>
<li>논리 연산자
<ul>
<li><code>and</code>, <code>or</code>, <code>not</code> : 문자 그대로의 의미를 가진다.</li>
<li>논리 연산에서는 <code>nil</code>과 <code>false</code>를 모두 <code>거짓</code>으로 판단한다.</li>
<li>이때 먼저 위치한 타입을 따른다.</li>
</ul>
<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#d08770;">nil </span><span>and </span><span style="color:#d08770;">false
</span><span style="color:#d08770;">false </span><span>and </span><span style="color:#d08770;">nil
</span></code></pre>
<ul>
<li>위 코드의 첫 번째 문장을 실행하면 <code>nil</code>, 두 번째 문장을 실행하면 <code>false</code>를 출력한다.</li>
</ul>
</li>
<li>조건 연산자
<ul>
<li><code>and</code>, <code>or</code>를 조합하여 아래와 같이 사용한다.</li>
</ul>
<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#bf616a;">max </span><span>= (</span><span style="color:#bf616a;">x </span><span>&gt; </span><span style="color:#bf616a;">y</span><span>) and </span><span style="color:#bf616a;">x </span><span>or </span><span style="color:#bf616a;">y
</span></code></pre>
<ul>
<li>위 프로그램은 x, y중 더 큰 값을 max에 저장한다.</li>
</ul>
</li>
<li>string operators
<ul>
<li><code>..</code>을 사용하여 string concatenation이 가능하다.</li>
<li><code>sub</code>메소드를 사용하여 string을 자를 수 있다.</li>
</ul>
<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#bf616a;">s </span><span>= &quot;</span><span style="color:#a3be8c;">hello</span><span>&quot;
</span><span style="color:#bf616a;">s</span><span>:</span><span style="color:#bf616a;">sub</span><span>(</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">2</span><span>)
</span></code></pre>
<ul>
<li>위 코드를 실행하면 &quot;he&quot;가 출력된다.</li>
</ul>
</li>
<li>대입 연산자
<ul>
<li>다중 대입 연산을 지원한다.</li>
<li>필드 개수가 안 맞으면 남는 값은 버린다.</li>
<li>변수의 개수가 더 많은 경우 남는 변수는 <code>nil</code>로 설정된다.</li>
</ul>
<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#bf616a;">a</span><span>, </span><span style="color:#bf616a;">b</span><span>, </span><span style="color:#bf616a;">c </span><span>= </span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">1
</span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#bf616a;">a</span><span>, </span><span style="color:#bf616a;">b</span><span>, </span><span style="color:#bf616a;">c</span><span>)
</span><span>
</span><span style="color:#bf616a;">x</span><span>, </span><span style="color:#bf616a;">y </span><span>= </span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">2
</span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#bf616a;">x</span><span>, </span><span style="color:#bf616a;">y</span><span>)
</span></code></pre>
<ul>
<li>위 코드의 2행을 실행시킨 결과는 0, 1, <code>nil</code>이다.</li>
<li>위 코드의 5행을 실행시킨 결과는 0, 1이다.</li>
</ul>
</li>
<li>Sharp(#)
<ul>
<li><code>Lua</code>에서는 크기를 측정할 때 <code>#</code>을 사용한다.</li>
<li>아래는 문자열 크기를 측정하는 예시이다. 출력값은 5이다.</li>
</ul>
<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#96b5b4;">print</span><span>(#&quot;</span><span style="color:#a3be8c;">HEllo</span><span>&quot;)
</span></code></pre>
</li>
<li>Modulo Operation
<ul>
<li>원래 Lua에는 modulo연산자가 없었다.</li>
<li>math 라이브러리를 활용해서 math.fmod(17, 5)와 같이 기술하여 구현했다.</li>
<li>또는 몫과 나멎지 사이의 관계를 통해 나머지 연산을 구현하기도 했다.
<ul>
<li>math.fmod(17, 5)와 같은 표현으로 17 - math.floor(17/5) * 5를 사용할 수 있다.</li>
</ul>
</li>
<li>위의 두 방법은 음수에 대한 나머지 연산 시 차이가 있으므로 이를 생각해야 한다.
<ul>
<li>fmod는 좌측 인수의 부호를 따라가지만 floor는 항상 작은 정수를 반환하기 때문에 차이가 생긴다.</li>
</ul>
</li>
<li>현재는 Lua에서 <code>%</code>연산자를 지원하므로 이렇게 구현할 필요는 없다.</li>
</ul>
</li>
</ul>
<h3 id="comments">Comments</h3>
<ul>
<li>One Line Comment : <code>--</code>를 사용하면 해당 행의 끝까지 주석 처리된다.</li>
<li>Multiline Comment : <code>--[[ statement ]]</code>처럼 사용하면 괄호 쌍 안의 모든 내용이 주석 처리된다.</li>
<li><code>[[ ]]</code>괄호 쌍 안의 문자열은 long string literal로 사용되므로 print등 다른 함수에서도 사용 가능하다.</li>
</ul>
<h3 id="scope">Scope</h3>
<ul>
<li>기본적으로 <code>Lua</code>의 모든 변수는 global variable이다.</li>
<li>지역 변수를 사용하려면 키워드 <code>local</code>을 사용해야 한다.</li>
<li><code>Lua</code>의 함수 내부에서 함수를 정의할 수 있는데, 이 경우 내부 함수 역시 global function이다.</li>
</ul>
<h3 id="control-structure">Control Structure</h3>
<ul>
<li><code>if-else</code>구문은 아래 코드처럼 마지막에 <code>end</code>키워드를 사용해야 한다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">if </span><span style="color:#bf616a;">a</span><span>&lt;</span><span style="color:#bf616a;">b </span><span style="color:#b48ead;">then 
</span><span>	</span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">a 
</span><span style="color:#b48ead;">else 
</span><span>	</span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">b 
</span><span style="color:#b48ead;">end
</span></code></pre>
</li>
<li><code>while</code>, <code>for</code>역시 마지막에 <code>end</code>키워드를 사용해야 한다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">while </span><span style="color:#bf616a;">condition </span><span style="color:#b48ead;">do
</span><span>	</span><span style="color:#65737e;">-- statement
</span><span style="color:#b48ead;">end
</span><span>
</span><span style="color:#65737e;">-- Generic For Loop
</span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">variable </span><span style="color:#b48ead;">in </span><span style="color:#bf616a;">structure </span><span style="color:#b48ead;">do
</span><span>	</span><span style="color:#65737e;">-- statement
</span><span>	</span><span style="color:#65737e;">-- structure 자리에는 iterator 가 위치한다.
</span><span>	</span><span style="color:#65737e;">-- Generic For Loop의 경우 iterator가 모두 순회할 때까지 반복한다.
</span><span style="color:#b48ead;">end
</span><span>
</span><span style="color:#65737e;">-- Neumeric For Loop
</span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">i</span><span>=</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">10</span><span>, </span><span style="color:#d08770;">2 </span><span style="color:#b48ead;">do
</span><span>	</span><span style="color:#65737e;">-- statement
</span><span>	</span><span style="color:#65737e;">-- 증분 값을 생략하면 1로 자동 설정된다.
</span><span style="color:#b48ead;">end
</span></code></pre>
</li>
</ul>
<h3 id="functions">Functions</h3>
<ul>
<li><code>Lua</code>에서 함수를 정의할 때는 <code>function</code>키워드를 이용한다.</li>
<li>함수가 끝날 때는 <code>end</code>를 사용하여 함수의 선언이 종료되었음을 명시해야 한다.</li>
<li>대입과 마찬가지로 부족한 인수는 <code>nil</code>로 전달되며, 남는 인수는 버린다.</li>
<li>아래 함수는 두 값을 더하는 함수 add이다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">add</span><span>(a, b)
</span><span>	</span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">a </span><span>+ </span><span style="color:#bf616a;">b
</span><span style="color:#b48ead;">end
</span></code></pre>
</li>
<li><code>Lua</code>는 Default Argument를 지원하지 않는다. 하지만 조건 연산자를 이용하면 비슷한 역할을 하도록 구현할 수 있다.</li>
<li>아래는 인수가 주어지지 않은 경우(<code>nil</code>인 경우 원하는 기본 인수(0)으로 설정하는 함수이다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">add</span><span>(a, b)
</span><span>	</span><span style="color:#bf616a;">b </span><span>= </span><span style="color:#bf616a;">b </span><span>or </span><span style="color:#d08770;">0
</span><span>	</span><span style="color:#bf616a;">a </span><span>= </span><span style="color:#bf616a;">a </span><span>or </span><span style="color:#d08770;">0
</span><span>	</span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">a </span><span>+ </span><span style="color:#bf616a;">b
</span><span style="color:#b48ead;">end
</span></code></pre>
</li>
<li>아래는 팩토리얼을 계산하는 <code>Lua</code>함수이다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">factorial</span><span>(n)
</span><span>	</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">n </span><span>== </span><span style="color:#d08770;">0 </span><span style="color:#b48ead;">then 
</span><span>		</span><span style="color:#b48ead;">return </span><span style="color:#d08770;">1
</span><span>	</span><span style="color:#b48ead;">else
</span><span>		</span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">n </span><span>* </span><span style="color:#bf616a;">factorial</span><span>(</span><span style="color:#bf616a;">n</span><span>-</span><span style="color:#d08770;">1</span><span>)
</span><span>	</span><span style="color:#b48ead;">end
</span><span style="color:#b48ead;">end
</span></code></pre>
</li>
<li>이를 tail recursion을 만족하도록 수정하면 다음과 같다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">tailFactorial</span><span>(n, acc)
</span><span>	</span><span style="color:#bf616a;">acc </span><span>= </span><span style="color:#bf616a;">acc </span><span>or </span><span style="color:#d08770;">1
</span><span>	</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">n </span><span>== </span><span style="color:#d08770;">0 </span><span style="color:#b48ead;">then
</span><span>		</span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">acc
</span><span>	</span><span style="color:#b48ead;">else
</span><span>		</span><span style="color:#bf616a;">acc </span><span>= </span><span style="color:#bf616a;">acc </span><span>* </span><span style="color:#bf616a;">n
</span><span>		</span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">tailFactorial</span><span>(</span><span style="color:#bf616a;">n</span><span>-</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#bf616a;">acc</span><span>)
</span><span>	</span><span style="color:#b48ead;">end
</span><span style="color:#b48ead;">end
</span></code></pre>
</li>
</ul>
<h3 id="lambda">Lambda</h3>
<ul>
<li><code>람다 함수</code>란 이름 없는 함수를 뜻한다.</li>
<li>키워드 <code>function</code>다음에 아무 이름 없이 함수를 쓰면 <code>람다 함수</code>가 된다.</li>
<li>아래는 덧셈을 수행하는 람다 함수 프로그램이다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span>(</span><span style="color:#b48ead;">function</span><span>(a, b) </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">a</span><span>+</span><span style="color:#bf616a;">b </span><span style="color:#b48ead;">end</span><span>)(</span><span style="color:#d08770;">2</span><span>, </span><span style="color:#d08770;">3</span><span>)
</span></code></pre>
</li>
<li>람다 함수를 사용하면 아래와 같이 지역 함수를 정의할 수 있다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">add</span><span>(a, b)
</span><span>	</span><span style="color:#b48ead;">local </span><span style="color:#8fa1b3;">add1 </span><span>= </span><span style="color:#b48ead;">function</span><span>(b)
</span><span>		</span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">b </span><span>+ </span><span style="color:#d08770;">1
</span><span>	</span><span style="color:#b48ead;">end
</span><span>	</span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">a </span><span>== </span><span style="color:#d08770;">0 </span><span>and </span><span style="color:#bf616a;">b </span><span>or </span><span style="color:#bf616a;">add</span><span>(</span><span style="color:#bf616a;">a</span><span>-</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#bf616a;">add1</span><span>(</span><span style="color:#bf616a;">b</span><span>))
</span><span style="color:#b48ead;">end
</span></code></pre>
</li>
<li>재귀 지역 함수(Recursive Local Function)의 사용에서 주의사항<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">count</span><span>(n)
</span><span>	</span><span style="color:#b48ead;">local </span><span style="color:#8fa1b3;">down </span><span>= </span><span style="color:#b48ead;">function</span><span>(n)
</span><span>		</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">n </span><span>== </span><span style="color:#d08770;">0 </span><span style="color:#b48ead;">then
</span><span>			</span><span style="color:#96b5b4;">print</span><span>(&quot;</span><span style="color:#a3be8c;">Beep!</span><span>&quot;)
</span><span>		</span><span style="color:#b48ead;">else
</span><span>			</span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#bf616a;">n</span><span>)
</span><span>			</span><span style="color:#bf616a;">down</span><span>(</span><span style="color:#bf616a;">n</span><span>-</span><span style="color:#d08770;">1</span><span>)
</span><span>		</span><span style="color:#b48ead;">end
</span><span>	</span><span style="color:#b48ead;">end
</span><span>	</span><span style="color:#bf616a;">down</span><span>(</span><span style="color:#bf616a;">n</span><span>)
</span><span style="color:#b48ead;">end
</span></code></pre>
<ul>
<li>위와 같이 선언할 경우 down의 값은 <code>nil</code>이므로 위 프로그램은 오류이다.</li>
</ul>
</li>
<li>아래처럼 지역 변수를 먼저 선언한 후 할당하면, 함수 호출 시 선언된 지역 변수 값을 이용하므로 문제가 없다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span>	</span><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">count</span><span>(n)
</span><span>	</span><span style="color:#b48ead;">local </span><span style="color:#bf616a;">down
</span><span>	</span><span style="color:#8fa1b3;">down </span><span>= </span><span style="color:#b48ead;">function</span><span>(n)
</span><span>		</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">n </span><span>== </span><span style="color:#d08770;">0 </span><span style="color:#b48ead;">then
</span><span>			</span><span style="color:#96b5b4;">print</span><span>(&quot;</span><span style="color:#a3be8c;">Beep!</span><span>&quot;)
</span><span>		</span><span style="color:#b48ead;">else
</span><span>			</span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#bf616a;">n</span><span>)
</span><span>			</span><span style="color:#bf616a;">down</span><span>(</span><span style="color:#bf616a;">n</span><span>-</span><span style="color:#d08770;">1</span><span>)
</span><span>		</span><span style="color:#b48ead;">end
</span><span>	</span><span style="color:#b48ead;">end
</span><span>	</span><span style="color:#bf616a;">down</span><span>(</span><span style="color:#bf616a;">n</span><span>)
</span><span style="color:#b48ead;">end
</span></code></pre>
</li>
</ul>
<h3 id="file-input-and-output">File Input and Output</h3>
<ul>
<li>파일을 모드 문자열에 지정된 대로 여는 방법(file open)<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#bf616a;">handle </span><span>= io.</span><span style="color:#96b5b4;">open</span><span>(</span><span style="color:#bf616a;">fileName</span><span>, </span><span style="color:#bf616a;">MODE</span><span>)
</span></code></pre>
</li>
<li>기본 입력 혹은 출력을 handle로 바꾸는 방법(file set)<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span>io.</span><span style="color:#96b5b4;">input</span><span>(</span><span style="color:#bf616a;">handle</span><span>), io.</span><span style="color:#96b5b4;">output</span><span>(</span><span style="color:#bf616a;">handle</span><span>)
</span></code></pre>
</li>
<li>파일을 닫는 방법<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span>io.</span><span style="color:#96b5b4;">close</span><span>(</span><span style="color:#bf616a;">handle</span><span>)
</span></code></pre>
</li>
</ul>
<h3 id="input">Input</h3>
<ul>
<li>문자열을 입력받아 반환<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span>io.</span><span style="color:#96b5b4;">read</span><span>()
</span></code></pre>
</li>
<li>수를 입력받아 반환<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span>io.</span><span style="color:#96b5b4;">read</span><span>(&quot;</span><span style="color:#a3be8c;">*n</span><span>&quot;)
</span></code></pre>
</li>
<li>한 행을 입력받아 반환<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span>io.</span><span style="color:#96b5b4;">read</span><span>(&quot;</span><span style="color:#a3be8c;">1*</span><span>&quot;)
</span></code></pre>
</li>
<li>파일 내 모든 데이터를 입력받아 반환<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span>io.</span><span style="color:#96b5b4;">read</span><span>(&quot;</span><span style="color:#a3be8c;">*a</span><span>&quot;)
</span></code></pre>
</li>
</ul>
<h3 id="output">output</h3>
<ul>
<li>데이터를 출력한다<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#bf616a;">data</span><span>)
</span></code></pre>
</li>
<li>파일의 맨 끝 행에 출력한다. print와 달리 개행문자를 출력하지 않는다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span>io.</span><span style="color:#96b5b4;">write</span><span>(</span><span style="color:#bf616a;">data</span><span>)
</span></code></pre>
</li>
</ul>
<h3 id="closure">Closure</h3>
<p><img src="/image/PL/closure.png" alt="Closure" /></p>
<ul>
<li>참조 환경과 함수를 묶은 것을 <code>Closure</code>라고 한다.</li>
<li>언제든지 함수를 계산할 수 있는 형태이다.</li>
<li>람다 함수는 참조 환경이 없는 클로저라고 볼 수 있다.</li>
<li>아래는 <code>Lua</code>의 <code>Closure</code>를 정의한 예시이다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">newCounter</span><span>()
</span><span>	</span><span style="color:#b48ead;">local </span><span style="color:#bf616a;">i </span><span>= -</span><span style="color:#d08770;">1
</span><span>	</span><span style="color:#b48ead;">return function</span><span>() </span><span style="color:#bf616a;">i </span><span>= </span><span style="color:#bf616a;">i </span><span>+ </span><span style="color:#d08770;">1 </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">i </span><span style="color:#b48ead;">end
</span><span style="color:#b48ead;">end
</span></code></pre>
</li>
<li>아래는 위의 <code>Closure</code> 사용 예시이다.
<ul>
<li>newCounter()가 총 10번 실행된다.</li>
<li>이때 newCounter()의 호출 시마다 내부 참조 환경 i의 값이 바뀌어 매번 다른 값을 반환한다.</li>
</ul>
<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#bf616a;">c1 </span><span>= </span><span style="color:#bf616a;">newCounter</span><span>()
</span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">i </span><span>= </span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">10 </span><span style="color:#b48ead;">do </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#bf616a;">c1</span><span>()) </span><span style="color:#b48ead;">end
</span></code></pre>
</li>
</ul>
<h3 id="iterator">Iterator</h3>
<ul>
<li>어떤 자료 구조의 모든 자료를 훑는 함수를 반복자(iterator)라고 한다.</li>
<li><code>Lua</code>의 <code>Closure</code>를 이용하면 반복자를 작성할 수 있다.</li>
<li>아래는 <code>Lua</code>의 반복자 정의 예시이다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">function </span><span style="color:#8fa1b3;">iterator</span><span>(t)
</span><span>	</span><span style="color:#b48ead;">local </span><span style="color:#bf616a;">i</span><span>, </span><span style="color:#bf616a;">sz </span><span>= </span><span style="color:#d08770;">0</span><span>, #</span><span style="color:#bf616a;">t
</span><span>	</span><span style="color:#b48ead;">return function</span><span>()
</span><span>		</span><span style="color:#bf616a;">i </span><span>= </span><span style="color:#bf616a;">i </span><span>+ </span><span style="color:#d08770;">1
</span><span>		</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">i </span><span>&lt;= </span><span style="color:#bf616a;">sz </span><span style="color:#b48ead;">then return </span><span style="color:#bf616a;">t</span><span>[</span><span style="color:#bf616a;">i</span><span>] </span><span style="color:#b48ead;">end
</span><span>	</span><span style="color:#b48ead;">end
</span><span style="color:#b48ead;">end
</span></code></pre>
</li>
<li>아래는 위 프로그램에서 정의한 반복자를 사용하는 <code>Lua</code>프로그램의 예시이다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#b48ead;">for </span><span style="color:#bf616a;">n </span><span style="color:#b48ead;">in </span><span style="color:#bf616a;">iterator</span><span>({</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">2</span><span>, </span><span style="color:#d08770;">3</span><span>, </span><span style="color:#d08770;">4</span><span>}) </span><span style="color:#b48ead;">do </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#bf616a;">n</span><span>) </span><span style="color:#b48ead;">end
</span></code></pre>
</li>
</ul>
<h3 id="coroutine">Coroutine</h3>
<ul>
<li>자신만의 수행 상태를 지니고 있는 함수를 <code>Coroutine</code>이라고 부른다.</li>
<li>이전 상태를 기억한다는 측면에서 과거 인식 함수(history sensitive function)과 유사하다.</li>
<li>자신만의 수행 상태가 유지된다는 측면에서 스레드(Thread)와 유사하다.</li>
<li>하지만 병렬 수행은 불가하므로 유사병렬성(quasi-concurrency)을 구현하는데 사용된다.</li>
<li><code>Coroutine</code>은 수행 상태를 유지해야 하므로 아래의 상태 중 하나에 놓이게 된다.
<ul>
<li><code>중단(suspend)</code> : <code>Coroutine</code>이 생성되었으나 실행되고 있지 않은 상태</li>
<li><code>실행(running)</code> : <code>Coroutine</code>이 실행 중인 상태</li>
<li><code>종료(dead)</code> : <code>Coroutine</code>의 본체가 모두 수행되어 종료된 상태</li>
</ul>
</li>
<li><code>Lua</code>에서의 <code>Coroutine</code>은 통상적인 <code>Coroutine</code>과 달리 호출자와 피호출자가 구분되는 asymetric <code>Coroutine</code>이다.</li>
<li><code>Coroutine</code>은 상태를 지니고 있다는 점에서 <code>Iterator</code>와 유사한 측면이 있다. 하지만 <code>Coroutine</code>은 <code>Iterator</code>보다 훨씬 다양한 상태에 있을 수 있으므로 훨씬 강력하다.</li>
<li>아래의 코드는 <code>Coroutine</code>을 사용한 <code>Lua</code>프로그램 코드이다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#bf616a;">cntdown </span><span>= coroutine.</span><span style="color:#96b5b4;">create</span><span>(</span><span style="color:#b48ead;">function</span><span>()
</span><span>	coroutine.</span><span style="color:#96b5b4;">yield</span><span>(</span><span style="color:#d08770;">5</span><span>)
</span><span>	coroutine.</span><span style="color:#96b5b4;">yield</span><span>(</span><span style="color:#d08770;">4</span><span>)
</span><span>	coroutine.</span><span style="color:#96b5b4;">yield</span><span>(</span><span style="color:#d08770;">3</span><span>)
</span><span>	coroutine.</span><span style="color:#96b5b4;">yield</span><span>(</span><span style="color:#d08770;">2</span><span>)
</span><span>	coroutine.</span><span style="color:#96b5b4;">yield</span><span>(</span><span style="color:#d08770;">1</span><span>)
</span><span style="color:#b48ead;">end</span><span>)
</span><span>
</span><span style="color:#b48ead;">repeat
</span><span>	</span><span style="color:#bf616a;">state</span><span>, </span><span style="color:#bf616a;">cnt </span><span>= coroutine.</span><span style="color:#96b5b4;">resume</span><span>(</span><span style="color:#bf616a;">cntdown</span><span>)
</span><span>	</span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#bf616a;">cnt </span><span>== </span><span style="color:#d08770;">nil </span><span>and &quot;</span><span style="color:#a3be8c;">Blast</span><span>&quot; or </span><span style="color:#bf616a;">cnt</span><span>, </span><span style="color:#bf616a;">state</span><span>)
</span><span style="color:#b48ead;">until </span><span>coroutine.</span><span style="color:#96b5b4;">status</span><span>(</span><span style="color:#bf616a;">cntdown</span><span>) == &quot;</span><span style="color:#a3be8c;">dead</span><span>&quot;
</span><span>
</span><span style="color:#bf616a;">state</span><span>, </span><span style="color:#bf616a;">cnt </span><span>= coroutine.</span><span style="color:#96b5b4;">resume</span><span>(</span><span style="color:#bf616a;">cntdown</span><span>)
</span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#bf616a;">cnt</span><span>, </span><span style="color:#bf616a;">state</span><span>)
</span></code></pre>
</li>
<li><code>coroutine.create</code>를 통해 <code>Coroutine</code>을 생성한다.</li>
<li><code>coroutine.tield</code>를 통해 <code>Coroutine</code>을 실행한다(사실상 return의 역할을 수행한다).</li>
<li><code>coroutine.resume</code>을 통해 <code>Coroutine</code>을 재개한다.</li>
<li><code>coroutine.status</code>를 통해 현재 <code>Coroutine</code>의 상태를 반환한다.</li>
</ul>
<h3 id="pail-ibculryeog-coroutineheu-sahyonhan-yesi-peuroggeraem">파일 입출력 &amp; Coroutine을 사용한 예시 프로그램</h3>
<ul>
<li>아래 프로그램은 1부터 입력받은 수 n까지의 모든 수 중 짝수만을 <code>evens.txt</code>에 write하는 프로그램이다.<pre data-lang="Lua" style="background-color:#2b303b;color:#c0c5ce;" class="language-Lua "><code class="language-Lua" data-lang="Lua"><span style="color:#8fa1b3;">producer </span><span>= </span><span style="color:#b48ead;">function</span><span>(n)
</span><span>	</span><span style="color:#b48ead;">return </span><span>coroutine.</span><span style="color:#96b5b4;">create</span><span>(</span><span style="color:#b48ead;">function</span><span>()
</span><span>		</span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">i </span><span>= </span><span style="color:#d08770;">1</span><span>, </span><span style="color:#bf616a;">n </span><span style="color:#b48ead;">do </span><span>coroutine.</span><span style="color:#96b5b4;">yield</span><span>(</span><span style="color:#bf616a;">i</span><span>) </span><span style="color:#b48ead;">end
</span><span>	</span><span style="color:#b48ead;">end</span><span>)
</span><span style="color:#b48ead;">end
</span><span>
</span><span style="color:#8fa1b3;">consumer </span><span>= </span><span style="color:#b48ead;">function</span><span>(p)
</span><span>	</span><span style="color:#b48ead;">return </span><span>coroutine.</span><span style="color:#96b5b4;">create</span><span>(</span><span style="color:#b48ead;">function</span><span>()
</span><span>		</span><span style="color:#bf616a;">handle </span><span>= io.</span><span style="color:#96b5b4;">open</span><span>(&quot;</span><span style="color:#a3be8c;">evens.txt</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">w</span><span>&quot;)
</span><span>		io.</span><span style="color:#96b5b4;">output</span><span>(</span><span style="color:#bf616a;">handle</span><span>)
</span><span>		</span><span style="color:#b48ead;">repeat
</span><span>			</span><span style="color:#bf616a;">_</span><span>, </span><span style="color:#bf616a;">num </span><span>= coroutine.</span><span style="color:#96b5b4;">resume</span><span>(</span><span style="color:#bf616a;">p</span><span>)
</span><span>			</span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">num </span><span>% </span><span style="color:#d08770;">2 </span><span>== </span><span style="color:#d08770;">0 </span><span style="color:#b48ead;">then
</span><span>				io.</span><span style="color:#96b5b4;">write</span><span>(</span><span style="color:#bf616a;">num</span><span>)
</span><span>				io.</span><span style="color:#96b5b4;">write</span><span>(&quot;</span><span style="color:#96b5b4;">\n</span><span>&quot;)
</span><span>			</span><span style="color:#b48ead;">end
</span><span>		</span><span style="color:#b48ead;">until </span><span>coroutine.</span><span style="color:#96b5b4;">status</span><span>(</span><span style="color:#bf616a;">p</span><span>) == &quot;</span><span style="color:#a3be8c;">dead</span><span>&quot;
</span><span>		io.</span><span style="color:#96b5b4;">close</span><span>(</span><span style="color:#bf616a;">handle</span><span>)
</span><span>	</span><span style="color:#b48ead;">end</span><span>)
</span><span style="color:#b48ead;">end
</span><span>
</span><span style="color:#bf616a;">n </span><span>= io.</span><span style="color:#96b5b4;">read</span><span>(&quot;</span><span style="color:#a3be8c;">*n</span><span>&quot;)
</span><span style="color:#bf616a;">p </span><span>= </span><span style="color:#bf616a;">producer</span><span>(</span><span style="color:#bf616a;">n</span><span>)
</span><span style="color:#bf616a;">c </span><span>= </span><span style="color:#bf616a;">consumer</span><span>(</span><span style="color:#bf616a;">p</span><span>)
</span><span>coroutine.</span><span style="color:#96b5b4;">resume</span><span>(</span><span style="color:#bf616a;">c</span><span>)
</span></code></pre>
</li>
</ul>

  </div>

	

  <div class="pagination">
  	
		<a href="#" class="top">Top</a>
		
  </div>

  </main>

  
  <footer>
    <span>&copy; 2022 JS970. Made with <a href="https://www.getzola.org">Zola</a> using the <a
          href="https://github.com/aaranxu/tale-zola">Tale-Zola</a> theme.</span>
  </footer>
  
</body>
</html>
